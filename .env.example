# Webhook Router Configuration Example
# Copy this file to .env and update with your values

# Server Configuration
PORT=8080

# Master Encryption Key (REQUIRED - minimum 32 characters)
# This key is used for JWT authentication, OAuth2 secrets, and sensitive data encryption
ENCRYPTION_KEY=your-secret-key-minimum-32-characters-change-this

# Legacy Environment Variables (Deprecated - use ENCRYPTION_KEY instead)
# JWT_SECRET=your-secret-key-minimum-32-characters-change-this
# CONFIG_ENCRYPTION_KEY=your-32-byte-encryption-key-change-this

# Database Configuration
DATABASE_TYPE=sqlite                    # Options: sqlite, postgres, postgresql
DATABASE_PATH=./webhook_router.db       # For SQLite only

# PostgreSQL Configuration (if DATABASE_TYPE=postgres)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=webhook_router
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-postgres-password
POSTGRES_SSL_MODE=disable               # Options: disable, require, verify-ca, verify-full

# Redis Configuration (Optional - for distributed features)
REDIS_ADDRESS=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_POOL_SIZE=10

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT=100                 # Requests per window
RATE_LIMIT_WINDOW=60s                  # Time window

# Message Broker Configuration (Optional)
RABBITMQ_URL=amqp://guest:guest@localhost:5672/
DEFAULT_QUEUE=webhooks

# Logging Configuration
LOG_LEVEL=info                         # Options: debug, info, warn, error

# Email/SMTP Configuration (Optional - for password reset emails)
SMTP_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@example.com
SMTP_PASSWORD=your-smtp-password
SMTP_FROM=noreply@example.com
SMTP_FROM_NAME=Webhook Router
SMTP_USE_TLS=true                      # Use STARTTLS
SMTP_USE_SSL=false                     # Use implicit SSL/TLS
SMTP_SKIP_VERIFY=false                 # Skip TLS certificate verification (not recommended)

# Common SMTP Provider Examples:
# Gmail: smtp.gmail.com:587 (TLS) - Use App Password
# SendGrid: smtp.sendgrid.net:587 (TLS) - Username: apikey, Password: your-api-key
# Mailgun: smtp.mailgun.org:587 (TLS)
# Amazon SES: email-smtp.region.amazonaws.com:587 (TLS)
# Office 365: smtp.office365.com:587 (TLS)

# OAuth2 Configuration (Optional - for OAuth2-enabled triggers)
# Google OAuth2 (for Gmail IMAP, Google Calendar, etc.)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Microsoft OAuth2 (for Outlook, Office 365, etc.)
MICROSOFT_CLIENT_ID=your-microsoft-client-id
MICROSOFT_CLIENT_SECRET=your-microsoft-client-secret

# Broker-specific Configuration (Optional)
# AWS SQS/SNS
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key

# Google Cloud Pub/Sub
GCP_PROJECT_ID=your-gcp-project-id
GCP_TOPIC_ID=your-topic-id
GCP_SUBSCRIPTION_ID=your-subscription-id
GCP_CREDENTIALS_PATH=/path/to/service-account-key.json  # Or use GCP_CREDENTIALS_JSON
# GCP_CREDENTIALS_JSON={"type":"service_account",...}   # Full JSON credentials
GCP_CREATE_SUBSCRIPTION=true                             # Auto-create subscription if missing
GCP_ENABLE_ORDERING=false                                # Enable message ordering
GCP_ORDERING_KEY=                                        # Ordering key for ordered messages

# Kafka
KAFKA_BROKERS=localhost:9092
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=

# Webhook Router Specific Settings
# Maximum request body size (in bytes)
MAX_BODY_SIZE=10485760                # 10MB default

# Request timeout for webhook processing
WEBHOOK_TIMEOUT=30s

# Enable/disable specific features
ENABLE_TRIGGERS=true
ENABLE_PIPELINES=true
ENABLE_DISTRIBUTED=true                # Requires Redis

# Frontend Configuration
FRONTEND_ENABLED=true                  # Set to false for API-only mode
FRONTEND_PATH=frontend/dist            # Path to frontend build files

# Development Settings
DEV_MODE=false                         # Enable development mode with relaxed security
ENABLE_SWAGGER=true                    # Enable Swagger UI at /swagger

# Pipeline Configuration
PIPELINE_WORKER_COUNT=10               # Number of concurrent pipeline workers
PIPELINE_TIMEOUT=300s                  # Maximum pipeline execution time
PIPELINE_MAX_STAGES=50                 # Maximum stages per pipeline
ENABLE_JS_TRANSFORM=true               # Enable JavaScript transformations

# Trigger Manager Configuration
TRIGGER_HEALTH_CHECK_INTERVAL=60s      # How often to check trigger health
TRIGGER_MAX_PER_USER=100               # Maximum triggers per user
TRIGGER_DEFAULT_TIMEOUT=30s            # Default timeout for trigger operations

# Health Check Settings
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=5s

# Metrics and Monitoring (Optional)
METRICS_ENABLED=false
METRICS_PORT=9090
PROMETHEUS_ENABLED=false

# TLS/SSL Configuration (Optional)
TLS_ENABLED=false
TLS_CERT_FILE=/path/to/cert.pem
TLS_KEY_FILE=/path/to/key.pem

# CORS Configuration
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=*
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=*

# Webhook Retry Configuration
WEBHOOK_RETRY_ENABLED=true
WEBHOOK_RETRY_COUNT=3
WEBHOOK_RETRY_DELAY=5s
WEBHOOK_RETRY_MAX_DELAY=60s

# Cleanup and Maintenance
CLEANUP_ENABLED=true
CLEANUP_INTERVAL=24h                   # How often to run cleanup
CLEANUP_RETENTION_DAYS=30              # Keep webhook logs for this many days

# Performance Tuning
WORKER_POOL_SIZE=100                   # Number of concurrent webhook processors
DATABASE_MAX_CONNECTIONS=25
DATABASE_MAX_IDLE_CONNECTIONS=5
DATABASE_CONNECTION_MAX_LIFETIME=1h

# Debug Options
DEBUG_SQL=false                        # Log SQL queries
DEBUG_HTTP=false                       # Log HTTP requests/responses
DEBUG_PERFORMANCE=false                # Log performance metrics

# Environment and Deployment
ENVIRONMENT=development                # Options: development, staging, production
REGION=us-east-1                       # Deployment region
INSTANCE_ID=                           # Instance identifier (auto-generated if empty)

# Circuit Breaker Configuration
CIRCUIT_BREAKER_ENABLED=true           # Enable circuit breakers for external calls
CIRCUIT_BREAKER_THRESHOLD=5            # Failures before opening circuit
CIRCUIT_BREAKER_TIMEOUT=60s            # Time before attempting reset

# Cache Configuration
CACHE_ENABLED=true                     # Enable caching
CACHE_DEFAULT_TTL=300s                 # Default cache TTL
CACHE_MAX_SIZE=1000                    # Maximum cache entries per user

# Security Configuration
ALLOWED_WEBHOOK_HOSTS=                 # Comma-separated list of allowed webhook target hosts (empty=all)
BLOCK_PRIVATE_IPS=true                 # Block webhooks to private IP ranges
MAX_REDIRECT_COUNT=5                   # Maximum HTTP redirects to follow